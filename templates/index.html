<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <title>Registro - Lavanderia IFPI</title>
  </head>
  <body class="bg-light">
    <nav class="navbar navbar-dark mb-4 shadow navbar-custom">
      <div class="container">
        <span class="navbar-brand fw-bold">üß∫ Lavanderia IFPI</span>
        <div class="navbar-nav d-flex flex-row gap-3">
          <a class="nav-link active fw-bold" href="/registro">Registro</a>
          <a class="nav-link text-white" href="/gestao">Gest√£o</a>
          <a class="nav-link text-white" href="/consulta">Consultar</a>
          <a class="nav-link text-warning fw-bold" href="/">Sair</a>
        </div>
      </div>
    </nav>

    <div class="container">
      <div class="card card-registro shadow mx-auto">
        <div class="card-body p-5">
          <h2 class="text-center mb-4 fw-bold">
            Lavanderia <span class="text-success">Automatizada</span>
          </h2>
          <form action="/registrar_pedido" method="POST">
            <div class="row mb-4">
              <div class="col-md-6">
                <label class="form-label fw-bold">Cliente:</label>
                <input
                  type="text"
                  name="cliente"
                  class="form-control bg-light"
                  required
                />
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold">Telefone:</label>
                <input
                  type="text"
                  name="telefone"
                  class="form-control bg-light"
                  placeholder="(86) 99999-9999"
                  required
                />
              </div>
            </div>

            <h6 class="fw-bold mb-3">Detalhes da Pe√ßa:</h6>
            <div class="border rounded-3 overflow-hidden">
              <table class="table table-registro mb-0 align-middle text-center">
                <thead class="table-light">
                  <tr>
                    <th style="width: 25%">Tipo</th>
                    <th style="width: 10%">Quantidade</th>
                    <th style="width: 20%">Cor</th>
                    <th style="width: 20%">Estado</th>
                    <th style="width: 25%">Servi√ßo</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>
                      <select
                        name="tipo"
                        id="tipoPeca"
                        class="form-select border-0 bg-transparent"
                        onchange="atualizarPreco()"
                      >
                        <option value="Camisa">Camisa</option>
                        <option value="Cal√ßa">Cal√ßa</option>
                        <option value="Toalha">Toalha</option>
                        <option value="Roupa Delicada">Roupa Delicada</option>
                      </select>
                    </td>
                    <td>
                      <input
                        type="number"
                        name="quantidade"
                        id="qtdPeca"
                        class="form-control-table text-center"
                        value="1"
                        min="1"
                        oninput="atualizarPreco()"
                        required
                      />
                    </td>
                    <td>
                      <input
                        type="text"
                        name="cor"
                        class="form-control-table"
                        placeholder="Azul"
                        required
                      />
                    </td>
                    <td>
                      <input
                        type="text"
                        name="estado"
                        class="form-control-table"
                        placeholder="Sem manchas"
                        required
                      />
                    </td>
                    <td>
                      <select
                        name="servico"
                        class="form-select border-0 bg-transparent"
                      >
                        <option value="Lavar">Lavar</option>
                        <option value="Secar">Secar</option>
                        <option value="Passar">Passar</option>
                        <option value="Pacote Completo">Pacote Completo</option>
                      </select>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div
              class="mt-4 p-3 bg-light rounded-3 d-flex justify-content-between align-items-center border"
            >
              <div>
                <span class="text-muted small d-block">Valor Unit√°rio:</span>
                <span class="fw-bold text-dark"
                  >R$ <span id="exibirPreco">15.00</span></span
                >
              </div>
              <div class="text-end">
                <span class="text-muted small d-block">Total Estimado:</span>
                <h4 class="fw-bold text-success mb-0" id="totalEstimado">
                  R$ 15.00
                </h4>
                <small
                  class="text-danger fw-bold"
                  id="avisoDesconto"
                  style="display: none"
                >
                  10% de desconto aplicado! (Volume >= 5)
                </small>
              </div>
            </div>

            <button
              type="submit"
              class="btn btn-success w-100 py-3 fw-bold mt-4 shadow-sm"
            >
              Confirmar Registro do Pedido
            </button>
          </form>
        </div>
      </div>
    </div>

    <script>
      function atualizarPreco() {
        const precosBase = {
          Camisa: 15.0,
          Cal√ßa: 20.0,
          Toalha: 10.0,
          "Roupa Delicada": 25.0,
        };

        const tipo = document.getElementById("tipoPeca").value;
        const qtd = parseInt(document.getElementById("qtdPeca").value) || 1;

        let precoUn = precosBase[tipo] || 10.0;
        let total = precoUn * qtd;

        if (qtd >= 5) {
          total = total * 0.9;
          document.getElementById("avisoDesconto").style.display = "block";
        } else {
          document.getElementById("avisoDesconto").style.display = "none";
        }

        document.getElementById("exibirPreco").innerText = precoUn.toFixed(2);
        document.getElementById("totalEstimado").innerText =
          "R$ " + total.toFixed(2);
      }

      // Executa no carregamento inicial
      window.onload = atualizarPreco;
    </script>
  </body>
</html>
